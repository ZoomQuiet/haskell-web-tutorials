0a1
> {-# LANGUAGE DeriveGeneric #-}
4a6
> import GHC.Generics
5a8,10
> import Data.Aeson
> import Data.Aeson.Types (typeMismatch)
> import qualified Data.Vector as V
7d11
< import qualified Data.ByteString.Lazy as L
13c17,23
< type SimpleState = L.ByteString
---
> newtype SimpleState = SimpleState Int
>     deriving (Generic)
> 
> instance ToJSON SimpleState
> instance FromJSON SimpleState where
>     parseJSON (Array vec) = return $ SimpleState $ V.length vec
>     parseJSON o = typeMismatch "SimpleState" o
20c30
<         return $ response d
---
>         return $ response (encode d)
31c41,43
<         Right rsp -> void $ swapMVar state rsp
---
>         Right rsp -> maybe (putStrLn "decode json failed.")
>                            (void . swapMVar state)
>                            (decode rsp)
